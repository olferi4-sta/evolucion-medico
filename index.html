<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Evolución Clínica – Médico Interno HUEM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--azul:#1e88e5;--gris:#f4f6f8}
body{font-family:Segoe UI,Arial;background:var(--gris);padding:20px}
.container{max-width:1200px;margin:auto;background:#fff;padding:25px;border-radius:8px}
.header{border-bottom:4px solid var(--azul);margin-bottom:20px}
.section{margin-top:25px}
.section h2{background:var(--azul);color:#fff;padding:8px;border-radius:6px;font-size:15px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
input,select,textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:5px}
textarea{resize:vertical}
.actions{display:flex;gap:10px;margin-top:20px;flex-wrap:wrap}
button{background:var(--azul);color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer}
button.secondary{background:#6c757d}
.error{color:#b00020;margin-top:10px}
.ok{color:#1b5e20;font-weight:bold;margin-top:10px}
@media print{button,.actions,#btnMovil{display:none}}
@media (max-width:768px){
 body{padding:10px}.container{padding:15px}.section h2{text-align:center}
 input,select,textarea{font-size:16px}.actions{flex-direction:column}button{width:100%}
}
</style>
</head>
<body>

<div class="container">
<div class="header">
<h1>Evolución Clínica – Médico Interno</h1>
<small>Hospital Universitario Erasmo Meoz · Simulación académica</small>
</div>

<div class="section">
<h2>Acceso del estudiante</h2>
<div class="grid">
<select id="tipoDoc"><option value="">Tipo documento</option><option>RC</option><option>TI</option><option>CC</option><option>CE</option><option>PS</option></select>
<input id="numDoc" placeholder="Número de documento">
<input id="estudiante" placeholder="Nombre completo del médico interno">
</div>
</div>

<form id="form">

<div class="section">
<h2>1. Identificación del paciente</h2>
<div class="grid">
<input id="nombre" placeholder="Nombre paciente">
<input id="numDocPaciente" placeholder="Documento paciente">
<input type="number" id="edad" placeholder="Edad">
<select id="sexo"><option value="">Sexo</option><option>Masculino</option><option>Femenino</option></select>
<input id="servicio" placeholder="Servicio clínico">
</div>
</div>

<div class="section">
<h2>2. Subjetivo</h2>
<textarea id="subjetivo" placeholder="Mínimo 30 caracteres"></textarea>
</div>

<div class="section">
<h2>3. Signos vitales</h2>
<div class="grid">
<input id="peso" type="number" placeholder="Peso" oninput="imcCalc()">
<input id="talla" type="number" placeholder="Talla cm" oninput="imcCalc()">
<input id="imc" placeholder="IMC" readonly>
<input id="temperatura" type="number" step="0.1" placeholder="Temp °C">
<input id="glasgow" type="number" placeholder="Glasgow">
</div>
</div>

<div class="section">
<h2>4. Análisis</h2>
<textarea id="analisis" placeholder="Mínimo 50 caracteres"></textarea>
</div>

<div class="section">
<h2>5. Diagnóstico</h2>
<select id="cie10Principal">
<option value="">Seleccione</option>
<option value="I21">I21 Infarto agudo</option>
<option value="I21.0">IAM anterior</option>
<option value="I21.1">IAM inferior</option>
</select>
</div>

<div class="section">
<h2>6. Indicaciones</h2>
<textarea id="medicamentos"></textarea>
</div>

<div class="section">
<h2>Auditoría</h2>
<p><b>Estado:</b> <span id="estadoAuditoria">PENDIENTE</span></p>
<textarea id="obsAuditoria" readonly></textarea>
</div>

<div id="errores" class="error"></div>
<div id="ok" class="ok"></div>

<div class="actions">
<button type="submit">Validar</button>
<button type="button" onclick="enviarSheets()">Enviar evolución</button>
</div>

</form>
</div>

<script>
let resultadoConforme=false;

function imcCalc(){
 if(peso.value && talla.value){
   imc.value=(peso.value/Math.pow(talla.value/100,2)).toFixed(1);
 }
}

form.addEventListener("submit",e=>{
 e.preventDefault();
 let err=[];
 if(!estudiante.value) err.push("Nombre estudiante obligatorio");
 if(subjetivo.value.length<30) err.push("Subjetivo insuficiente");
 if(analisis.value.length<50) err.push("Análisis insuficiente");
 if(!cie10Principal.value) err.push("Diagnóstico obligatorio");

 errores.innerHTML=err.join("<br>");
 resultadoConforme=err.length===0;
 ok.innerHTML=resultadoConforme?"EVOLUCIÓN CONFORME":"";
 auditoria();
});

function auditoria(){
 let ok=true,obs=[];
 if(subjetivo.value.length<30){obs.push("Subjetivo incompleto");ok=false}
 if(analisis.value.length<50){obs.push("Análisis insuficiente");ok=false}
 if(!cie10Principal.value){obs.push("CIE10 faltante");ok=false}
 if(glasgow.value && glasgow.value<=8){obs.push("Paciente crítico");ok=false}
 estadoAuditoria.textContent=ok?"APROBADO":"NO APROBADO";
 estadoAuditoria.style.color=ok?"green":"red";
 obsAuditoria.value=obs.join(" | ");
}

function enviarSheets(){
 if(!resultadoConforme){alert("Primero valide la evolución");return;}

 const data={
  estudiante:estudiante.value,
  tipoDoc:tipoDoc.value,
  numDoc:numDoc.value,
  nombre:nombre.value,
  numDocPaciente:numDocPaciente.value,
  edad:edad.value,
  sexo:sexo.value,
  servicio:servicio.value,
  subjetivo:subjetivo.value,
  analisis:analisis.value,
  cie10Principal:cie10Principal.value,
  peso:peso.value,
  talla:talla.value,
  imc:imc.value,
  temperatura:temperatura.value,
  glasgow:glasgow.value,
  medicamentos:medicamentos.value
 };

 fetch("https://script.google.com/macros/s/AKfycbzvcniK58InnKtQ-Wl0Y8s7pPacUmAJNnGhFdidmHCfEcoAtej1RBET_qxcaiO8uvf-/exec",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(data)
 })
 .then(r=>r.json())
 .then(r=>{
   if(r.status==="ok"){alert("✔ Guardado en Google Sheets");form.reset();}
   else alert("Error: "+r.message);
 })
 .catch(err=>alert("Error conexión: "+err));
}
</script>

</body>
</html>

