<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Evolución Clínica – Médico Interno HUEM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --azul:#1e88e5;
  --gris:#f4f6f8;
}
body{
  font-family:Segoe UI, Arial, sans-serif;
  background:var(--gris);
  margin:0;
  padding:20px;
}
.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.header{
  border-bottom:4px solid var(--azul);
  margin-bottom:20px;
}
.header h1{color:var(--azul);margin:0}
small{color:#555}
.section{margin-top:25px}
.section h2{
  background:var(--azul);
  color:#fff;
  padding:8px 12px;
  border-radius:6px;
  font-size:15px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
  margin-top:12px;
}
input, select, textarea{
  width:100%;
  padding:8px;
  border:1px solid #ccc;
  border-radius:5px;
  font-size:14px;
}
textarea{resize:vertical}
.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:20px;
}
button{
  background:var(--azul);
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:6px;
  cursor:pointer;
}
button.secondary{background:#6c757d}
.error{color:#b00020;margin-top:10px}
.ok{color:#1b5e20;font-weight:bold;margin-top:10px}
ul{padding-left:20px}
@media print{
  button,.actions{display:none}
}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>Evolución Clínica – Médico Interno</h1>
<small>E.S.E Hospital Universitario Erasmo Meoz · Simulación académica</small>
</div>

<form id="form">

<!-- IDENTIFICACIÓN -->
<div class="section">
<h2>1. Identificación del paciente</h2>
<div class="grid">
<select id="tipoDoc">
<option value="">Tipo documento</option>
<option>RC</option><option>TI</option><option>CC</option>
<option>CE</option><option>PS</option><option>SV</option>
</select>
<input id="numDoc" placeholder="Número documento">
<input id="nombre" placeholder="Nombre completo">
<input type="number" id="edad" placeholder="Edad">
<input id="servicio" placeholder="Servicio">
</div>
</div>

<!-- SIGNOS -->
<div class="section">
<h2>2. Signos vitales</h2>
<div class="grid">
<input type="number" id="peso" placeholder="Peso (kg)" oninput="imcCalc()">
<input type="number" id="talla" placeholder="Talla (cm)" oninput="imcCalc()">
<input id="imc" placeholder="IMC" readonly>
<input type="number" id="tas" placeholder="TA Sistólica">
<input type="number" id="tad" placeholder="TA Diastólica">
<input type="number" id="fc" placeholder="FC">
<input type="number" id="glasgow" placeholder="Glasgow (3–15)">
</div>
</div>

<!-- EVOLUCIÓN -->
<div class="section">
<h2>3. Evolución clínica</h2>
<textarea id="subjetivo" placeholder="Subjetivo (mínimo 30 caracteres)"></textarea>
<textarea id="analisis" placeholder="Análisis clínico (mínimo 50 caracteres)"></textarea>
</div>

<!-- PLAN -->
<div class="section">
<h2>4. Plan terapéutico</h2>
<select id="dieta">
<option value="">Dieta</option>
<option>Libre</option>
<option>Blanda</option>
<option>Hiposódica</option>
<option>Diabética</option>
</select>
<textarea id="plan" placeholder="Plan (mínimo 30 caracteres)"></textarea>
</div>

<!-- DX -->
<div class="section">
<h2>5. Diagnóstico</h2>
<input id="dx" placeholder="CIE-10">
</div>

<div class="section">
<h2>6. Auditoría</h2>
<p id="resultado"></p>
<ul id="check"></ul>
</div>

<div id="errores" class="error"></div>
<div id="ok" class="ok"></div>

<div class="actions">
<button type="submit">Validar</button>
<button type="button" class="secondary" onclick="window.print()">PDF</button>
<button type="button" class="secondary" onclick="descargarCSV()">CSV</button>
<button type="button" class="secondary" onclick="enviarSheets()">Enviar evolución</button>
</div>

</form>
</div>

<script>
function imcCalc(){
  const p=peso.value, t=talla.value;
  if(p&&t) imc.value=(p/Math.pow(t/100,2)).toFixed(1);
}

form.addEventListener("submit",e=>{
  e.preventDefault();
  let err=[];
  if(!tipoDoc.value||!numDoc.value||!nombre.value) err.push("Identificación incompleta");
  if(subjetivo.value.length<30) err.push("Subjetivo insuficiente");
  if(analisis.value.length<50) err.push("Análisis insuficiente");
  if(plan.value.length<30) err.push("Plan incompleto");
  if(!dx.value) err.push("CIE-10 obligatorio");
  errores.innerHTML=err.join("<br>");
  ok.innerHTML=err.length===0?"EVOLUCIÓN CONFORME":"";
  auditoria();
});

function auditoria(){
  const items=[
    ["Identificación",tipoDoc.value&&numDoc.value],
    ["IMC",imc.value],
    ["Glasgow",glasgow.value>=3&&glasgow.value<=15],
    ["Diagnóstico",dx.value]
  ];
  check.innerHTML="";
  let conforme=true;
  items.forEach(i=>{
    const li=document.createElement("li");
    li.textContent=i[0]+": "+(i[1]?"CUMPLE":"NO CUMPLE");
    if(!i[1]) conforme=false;
    check.appendChild(li);
  });
  resultado.textContent=conforme?"APTA PARA AUDITORÍA Y RIPS":"NO CONFORME";
}

function descargarCSV(){
  const csv=[
    ["Documento","Paciente","IMC","DX"],
    [numDoc.value,nombre.value,imc.value,dx.value]
  ].map(r=>r.join(",")).join("\n");
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="evolucion.csv";
  a.click();
}

function enviarSheets(){
  fetch("https://script.google.com/macros/s/AKfycbxmjXNTYVDQBDZww9kwK7rMD8ANihP8OoIDeyGFmYye6Ntyup7FQyroWblxkZVT0URB/exec",{
    method:"POST",
    body:JSON.stringify({
      fecha:new Date().toISOString(),
      documento:numDoc.value,
      nombre:nombre.value,
      servicio:servicio.value,
      imc:imc.value,
      dx:dx.value
    })
  }).then(()=>alert("✔ Enviado a Google Sheets"));
}
</script>

</body>
</html>
